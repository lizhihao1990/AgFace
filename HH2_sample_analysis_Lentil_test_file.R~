# analyse test soil moisture data

library(ggplot2)

source("~/AgFace/R_scripts/HH2soil_moisture_import.R")


setwd("~/AgFace/2014/testfiles")
load("HH2_Tubes_lookup_table.RData")

# import file
HH2 <- HH2Import("19June14.CSV")

# assign IDs and treatments, etc

sm <- merge(HH2, TubeIDs,
            by.x = "Sample",
            by.y = "HH2_tube_number")
sm <- unique(sm)
sm <- sm[with(sm, order(Sample, Depth)), ]

p <- ggplot(sm[sm$Sample < 3, ], aes(x = mV, y = Depth))
  p <- p + geom_point(aes(colour = Tube_treatment))
  p <- p + geom_path(aes(colour = Tube_treatment))
  p <- p + scale_y_reverse()
  p <- p + facet_wrap( ~ Ring)
  p <- p + theme_bw()
  p <- p + labs(title = "Reference tubes")
p
fig.calib <- p

p <- ggplot(sm[!is.na(sm$Ring), ], aes(x = mV, y = Depth))
  p <- p + geom_point(aes(colour = as.factor(Sample)))
  p <- p + geom_path(aes(colour = as.factor(Sample)))
  p <- p + scale_y_reverse()
  p <- p + facet_wrap( ~ Ring)
  p <- p + theme_bw()
  p <- p + theme(legend.position = "none")
  p <- p + labs(title = "All rings, all sensors")
p
fig.mV <- p

pdf(file = "Soil_moisture_figures.pdf",
    width = 7, height = 7)
print(fig.calib)
print(fig.mV)
dev.off()
